{% extends "base.html" %}
{% block title %}Schichtübergaben{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2><i class="bi bi-arrow-left-right text-danger me-2"></i>Schichtübergaben</h2>
  <a href="{{ url_for('shifts.new_shift') }}" class="btn btn-danger">
    <i class="bi bi-plus-lg me-1"></i>Neue Übergabe
  </a>
</div>

{% if shifts %}
<div class="table-responsive">
  <table class="table table-hover table-striped align-middle">
    <thead class="table-dark">
      <tr>
        <th>#</th>
        <th>Datum</th>
        <th>Schicht</th>
        <th>Übergabe</th>
        <th>Vorkommnisse</th>
        <th>Erstellt von</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      {% for s in shifts %}
      <tr>
        <td class="text-muted small">{{ s.id }}</td>
        <td><strong>{{ s.shift_date }}</strong></td>
        <td><span class="badge bg-secondary">{{ s.shift_type_label }}</span></td>
        <td>
          <small>
            <i class="bi bi-person-fill text-danger"></i> {{ s.handover_from }}<br>
            <i class="bi bi-arrow-down text-muted"></i><br>
            <i class="bi bi-person-fill text-success"></i> {{ s.handover_to }}
          </small>
        </td>
        <td class="small">
          {% if s.incidents %}
            {{ s.incidents[:80] }}{% if s.incidents|length > 80 %}…{% endif %}
          {% else %}
            <span class="text-muted">–</span>
          {% endif %}
        </td>
        <td class="small">{{ s.created_by_user.username if s.created_by_user else "–" }}</td>
        <td>
          <a href="{{ url_for('shifts.detail_shift', shift_id=s.id) }}"
             class="btn btn-sm btn-outline-secondary">
            <i class="bi bi-eye"></i>
          </a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Pagination -->
{% if pagination.pages > 1 %}
<nav>
  <ul class="pagination pagination-sm justify-content-center">
    {% for page_num in pagination.iter_pages() %}
      {% if page_num %}
        <li class="page-item {% if page_num == pagination.page %}active{% endif %}">
          <a class="page-link" href="{{ url_for('shifts.list_shifts', page=page_num) }}">{{ page_num }}</a>
        </li>
      {% else %}
        <li class="page-item disabled"><span class="page-link">…</span></li>
      {% endif %}
    {% endfor %}
  </ul>
</nav>
{% endif %}

{% else %}
<div class="text-center py-5 text-muted">
  <i class="bi bi-arrow-left-right display-1"></i>
  <p class="mt-3">Noch keine Schichtübergaben eingetragen.</p>
  <a href="{{ url_for('shifts.new_shift') }}" class="btn btn-danger">Jetzt eintragen</a>
</div>
{% endif %}
{% endblock %}
