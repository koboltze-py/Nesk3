{% extends "base.html" %}
{% block title %}Fahrzeugzustand erfassen{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-lg-7">
    <div class="card shadow-sm">
      <div class="card-header bg-danger text-white">
        <h5 class="mb-0"><i class="bi bi-truck me-2"></i>Fahrzeugzustand erfassen</h5>
      </div>
      <div class="card-body">
        <form method="POST" novalidate>
          <div class="mb-3">
            <label for="vehicle_name" class="form-label fw-semibold">Fahrzeug / Kennzeichen <span class="text-danger">*</span></label>
            <input type="text" class="form-control" id="vehicle_name" name="vehicle_name"
                   required placeholder="z.B. RTW 1 / KO-DRK-01">
          </div>

          <div class="mb-3">
            <label for="status" class="form-label fw-semibold">Status <span class="text-danger">*</span></label>
            <select class="form-select" id="status" name="status" required>
              {% for val in status_values %}
              <option value="{{ val }}">{{ status_labels[val] }}</option>
              {% endfor %}
            </select>
          </div>

          <div class="row g-3 mb-3">
            <div class="col-sm-6">
              <label for="mileage" class="form-label fw-semibold">Kilometerstand</label>
              <div class="input-group">
                <input type="number" class="form-control" id="mileage" name="mileage"
                       step="0.1" min="0" placeholder="z.B. 125340">
                <span class="input-group-text">km</span>
              </div>
            </div>
            <div class="col-sm-6">
              <label for="fuel_level" class="form-label fw-semibold">Kraftstoffstand</label>
              <div class="input-group">
                <input type="number" class="form-control" id="fuel_level" name="fuel_level"
                       min="0" max="100" placeholder="z.B. 75">
                <span class="input-group-text">%</span>
              </div>
              <div id="fuelPreview" class="progress mt-2" style="height:8px;">
                <div class="progress-bar bg-success" id="fuelBar" style="width:0%"></div>
              </div>
            </div>
          </div>

          <div class="mb-3">
            <label for="recorded_at" class="form-label fw-semibold">Erfassungsdatum & -uhrzeit</label>
            <input type="datetime-local" class="form-control" id="recorded_at" name="recorded_at"
                   value="{{ now }}">
          </div>

          <div class="mb-4">
            <label for="notes" class="form-label fw-semibold">Bemerkungen / Mängel</label>
            <textarea class="form-control" id="notes" name="notes" rows="4"
                      placeholder="Mängel, Besonderheiten, Hinweise..."></textarea>
          </div>

          <div class="d-flex gap-2">
            <button type="submit" class="btn btn-danger">
              <i class="bi bi-floppy me-1"></i>Speichern
            </button>
            <a href="{{ url_for('vehicles.list_vehicles') }}" class="btn btn-outline-secondary">Abbrechen</a>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  // Kraftstoff-Vorschau
  const fuelInput = document.getElementById('fuel_level');
  const fuelBar = document.getElementById('fuelBar');
  fuelInput.addEventListener('input', () => {
    const val = parseInt(fuelInput.value) || 0;
    fuelBar.style.width = val + '%';
    fuelBar.className = 'progress-bar ' + (val < 25 ? 'bg-danger' : val < 50 ? 'bg-warning' : 'bg-success');
  });
</script>
{% endblock %}
